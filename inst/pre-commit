#!/bin/bash

# Check for staged R files
staged_files=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.R$')

if [ -z "$staged_files" ]; then
    echo "No R files staged."
    exit 0
else
    echo "R staged files detected. Use git add *.R files and commit again."
    exit 1
fi

# Run checks on each staged R file
for file in $staged_files; do
    echo "Checking $file..."

    # Check for syntax errors
    if ! Rscript -e "tools::checkRdaFiles('$file')" > /dev/null 2>&1; then
        echo "Syntax error in $file"
        exit 1
    fi

    # Optionally add linting (requires lintr package)
    if ! Rscript -e "lintr::lint('$file')" > /dev/null 2>&1; then
        echo "Linting issues found in $file"
        exit 1
    fi
done

echo "All checks passed."
exit 0
